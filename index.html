<!doctype html>
<html lang="ja">

<head>
    <meta charset="utf-8" />
    <title>DD Research Web</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Styles -->
    <link rel="stylesheet" href="styles.css" />

    <!-- Chart.js for line chart -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>

<body>
    <div class="wrap">
        <!-- Header -->
        <header>
            <span class="brand">DD Research Web</span>
            <span class="pill">Supabase REST</span>
            <span class="pill">Keepa連携対応</span>
            <span id="status" class="badge right">Idle</span>
        </header>

        <!-- Toolbar -->
        <div class="toolbar">
            <label>検索</label>
            <input id="q" type="text" placeholder="商品名 / JAN / SKU / ブランド / ASIN" />

            <label>ブランド</label>
            <input id="brand" type="text" placeholder="例: ミルボン" />

            <label>価格 ≤</label>
            <input id="priceMax" type="number" min="0" step="1" />

            <label>件/ページ</label>
            <select id="pageSize">
                <option>25</option>
                <option selected>50</option>
                <option>100</option>
                <option>200</option>
            </select>

            <label class="switch">
                <input id="asinOnly" type="checkbox" />
                ASINありのみ
            </label>

            <button id="reload" class="primary">再読み込み</button>
            <button id="exportCsv" class="ghost">CSV</button>
            <button id="openAmazonBulk" class="ghost">選択をAmazonで開く</button>
            <button id="clearSel" class="ghost">選択解除</button>
        </div>

        <!-- Main Content -->
        <div class="grid">
            <!-- Sidebar -->
            <aside>
                <!-- フィルタ・プリセット -->
                <div class="card">
                    <h3 style="margin:0 0 8px 0">フィルタ・プリセット</h3>
                    <div style="display:flex;gap:8px">
                        <input id="presetName" placeholder="プリセット名 (例: ミルボン ≤2000)" />
                        <button id="savePreset">保存</button>
                    </div>
                    <div id="presetList" style="margin-top:8px;display:grid;gap:8px"></div>
                </div>

                <!-- ASIN 半自動化 -->
                <div class="card" id="keepaCard">
                    <h3 style="margin:0 0 8px 0">ASIN 半自動化</h3>
                    <p class="muted" style="margin-top:0;margin-bottom:8px">
                        選択した行のJANコードを使用してASIN候補を検索します。
                    </p>
                    <button id="asinFromKeepa" class="ghost">選択行のJANでASIN候補を検索</button>
                </div>
            </aside>

            <!-- Main Table Area -->
            <div class="list">
                <div class="table-wrap">
                    <table id="tbl">
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="selAll" /></th>
                                <th>画像</th>
                                <th>商品名</th>
                                <th>ブランド</th>
                                <th>JAN</th>
                                <th>SKU</th>
                                <th class="num">DD価格</th>
                                <th>ASIN</th>
                                <th>ソース</th>
                                <th>最終取得</th>
                                <th>履歴</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="tbody"></tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <div class="pagination">
                    <button id="prev">前へ</button>
                    <span id="pageInfo" class="muted"></span>
                    <button id="next">次へ</button>
                    <span class="right muted" id="selInfo">選択 0 件</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Price History Modal -->
    <dialog id="dlg">
        <div class="modal-head">
            <strong id="dlgTitle">価格履歴</strong>
            <button id="dlgClose">閉じる</button>
        </div>
        <div class="modal-body">
            <div style="position: relative; height: 350px;">
                <canvas id="chart"></canvas>
            </div>
            <div id="histMeta" class="muted" style="margin-top:12px"></div>
        </div>
    </dialog>

    <!-- Configuration (動的読み込み) -->
    <script>
        // config.jsを動的に読み込み（存在しない場合はスキップ）
        const configScript = document.createElement('script');
        configScript.src = 'config.js';
        configScript.onerror = () => {
            console.warn('⚠️ config.js が見つかりません。config.js.example をコピーして config.js を作成してください。');
            // エラー時も初期化を実行（設定なしでエラーメッセージを表示）
            if (typeof init === 'function') {
                init();
            }
        };
        configScript.onload = () => {
            // config.js読み込み完了後に初期化を実行
            if (typeof init === 'function') {
                init();
            }
        };
        document.head.appendChild(configScript);
    </script>

    <!-- Application Script -->
    <script src="app.js"></script>
</body>

</html>