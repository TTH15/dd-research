<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASINæ¤œå‡ºãƒ„ãƒ¼ãƒ« - D-ONLINEå•†å“è©³ç´°ãƒšãƒ¼ã‚¸</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #333;
            border-bottom: 2px solid #0d6efd;
            padding-bottom: 10px;
        }

        .section {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 4px;
        }

        .section h2 {
            margin-top: 0;
            color: #0d6efd;
        }

        .result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            font-family: monospace;
        }

        .found {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .not-found {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        textarea {
            width: 100%;
            min-height: 300px;
            font-family: monospace;
            font-size: 12px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        button {
            background: #0d6efd;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px 10px 0;
        }

        button:hover {
            background: #0b5ed7;
        }

        .asin-pattern {
            font-weight: bold;
            color: #0d6efd;
        }

        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ” ASINæ¤œå‡ºãƒ„ãƒ¼ãƒ« - D-ONLINEå•†å“è©³ç´°ãƒšãƒ¼ã‚¸</h1>

        <div class="section">
            <h2>ğŸ“‹ ä½¿ã„æ–¹</h2>
            <ol>
                <li>D-ONLINEã®å•†å“è©³ç´°ãƒšãƒ¼ã‚¸ã‚’é–‹ã</li>
                <li>ãƒšãƒ¼ã‚¸ã®HTMLã‚’ã‚³ãƒ”ãƒ¼ï¼ˆå³ã‚¯ãƒªãƒƒã‚¯ â†’ ã€Œãƒšãƒ¼ã‚¸ã®ã‚½ãƒ¼ã‚¹ã‚’è¡¨ç¤ºã€ã¾ãŸã¯ <code>Cmd+Option+U</code>ï¼‰</li>
                <li>ä¸‹ã®ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã«è²¼ã‚Šä»˜ã‘ã‚‹</li>
                <li>ã€ŒASINã‚’æ¤œç´¢ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
            </ol>
        </div>

        <div class="section">
            <h2>ğŸ“ HTMLã‚’è²¼ã‚Šä»˜ã‘</h2>
            <textarea id="htmlInput" placeholder="ã“ã“ã«D-ONLINEå•†å“è©³ç´°ãƒšãƒ¼ã‚¸ã®HTMLã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„..."></textarea>
            <button onclick="searchASIN()">ğŸ” ASINã‚’æ¤œç´¢</button>
            <button onclick="clearInput()">ğŸ—‘ï¸ ã‚¯ãƒªã‚¢</button>
        </div>

        <div class="section">
            <h2>ğŸ“Š æ¤œç´¢çµæœ</h2>
            <div id="results"></div>
        </div>
    </div>

    <script>
        function searchASIN() {
            const html = document.getElementById('htmlInput').value;
            const resultsDiv = document.getElementById('results');

            if (!html.trim()) {
                resultsDiv.innerHTML = '<div class="result not-found">âŒ HTMLãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“</div>';
                return;
            }

            // HTMLã‚’ãƒ‘ãƒ¼ã‚¹
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');

            const findings = [];

            // ASINãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆB + 9æ–‡å­—ã®è‹±æ•°å­—ï¼‰
            const asinPattern = /B[0-9A-Z]{9}/g;

            // æ–¹æ³•1: metaã‚¿ã‚°ã‹ã‚‰å–å¾—
            const metaSelectors = [
                'meta[property="product:retailer_item_id"]',
                'meta[name="asin"]',
                'meta[property="og:retailer_item_id"]',
                'meta[property="product:asin"]',
                'meta[name="product:asin"]'
            ];

            for (const selector of metaSelectors) {
                const meta = doc.querySelector(selector);
                if (meta) {
                    const content = meta.getAttribute('content');
                    if (content && asinPattern.test(content)) {
                        const match = content.match(asinPattern);
                        findings.push({
                            method: `Metaã‚¿ã‚° (${selector})`,
                            asin: match[0],
                            source: content
                        });
                    }
                }
            }

            // æ–¹æ³•2: dataå±æ€§ã‹ã‚‰å–å¾—
            const dataSelectors = [
                '[data-asin]',
                '[data-product-asin]',
                '[data-amazon-asin]',
                '[data-item-asin]'
            ];

            for (const selector of dataSelectors) {
                const elements = doc.querySelectorAll(selector);
                elements.forEach(el => {
                    const asin = el.getAttribute('data-asin') ||
                        el.getAttribute('data-product-asin') ||
                        el.getAttribute('data-amazon-asin') ||
                        el.getAttribute('data-item-asin');
                    if (asin && asinPattern.test(asin)) {
                        const match = asin.match(asinPattern);
                        findings.push({
                            method: `Dataå±æ€§ (${selector})`,
                            asin: match[0],
                            source: asin
                        });
                    }
                });
            }

            // æ–¹æ³•3: ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰ASINãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¤œç´¢
            const textContent = doc.body.textContent || '';
            const textMatches = textContent.match(/ASIN[:\s]+(B[0-9A-Z]{9})/gi);
            if (textMatches) {
                textMatches.forEach(match => {
                    const asinMatch = match.match(asinPattern);
                    if (asinMatch) {
                        findings.push({
                            method: 'ãƒ†ã‚­ã‚¹ãƒˆæ¤œç´¢ (ASIN: ...)',
                            asin: asinMatch[0],
                            source: match.trim()
                        });
                    }
                });
            }

            // æ–¹æ³•4: Amazonãƒªãƒ³ã‚¯ã‹ã‚‰ASINã‚’æŠ½å‡º
            const amazonLinks = doc.querySelectorAll('a[href*="amazon.co.jp"], a[href*="amazon.com"]');
            amazonLinks.forEach(link => {
                const href = link.getAttribute('href') || '';
                const asinMatch = href.match(/[\/dp\/](B[0-9A-Z]{9})/);
                if (asinMatch) {
                    findings.push({
                        method: 'Amazonãƒªãƒ³ã‚¯',
                        asin: asinMatch[1],
                        source: href
                    });
                }
            });

            // æ–¹æ³•5: ã™ã¹ã¦ã®ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰ASINãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¤œç´¢
            const allMatches = textContent.match(asinPattern);
            if (allMatches) {
                const uniqueAsins = [...new Set(allMatches)];
                uniqueAsins.forEach(asin => {
                    // æ—¢ã«è¦‹ã¤ã‹ã£ãŸASINã¯ã‚¹ã‚­ãƒƒãƒ—
                    if (!findings.find(f => f.asin === asin)) {
                        findings.push({
                            method: 'ãƒ†ã‚­ã‚¹ãƒˆå…¨ä½“ã‹ã‚‰æ¤œç´¢',
                            asin: asin,
                            source: 'HTMLå…¨ä½“'
                        });
                    }
                });
            }

            // çµæœã‚’è¡¨ç¤º
            if (findings.length === 0) {
                resultsDiv.innerHTML = `
                    <div class="result not-found">
                        <h3>âŒ ASINãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</h3>
                        <p>ä»¥ä¸‹ã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼š</p>
                        <ul>
                            <li>ã“ã®å•†å“è©³ç´°ãƒšãƒ¼ã‚¸ã«ASINã¯å«ã¾ã‚Œã¦ã„ãªã„</li>
                            <li>ASINãŒåˆ¥ã®å½¢å¼ã§ä¿å­˜ã•ã‚Œã¦ã„ã‚‹</li>
                            <li>JavaScriptã§å‹•çš„ã«èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹</li>
                        </ul>
                        <p><strong>æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:</strong> JANã‚³ãƒ¼ãƒ‰ã‹ã‚‰Keepa APIã§ASINã‚’æ¤œç´¢ã™ã‚‹æ–¹æ³•ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚</p>
                    </div>
                `;
            } else {
                // é‡è¤‡ã‚’é™¤å»
                const uniqueFindings = [];
                const seenAsins = new Set();
                findings.forEach(f => {
                    if (!seenAsins.has(f.asin)) {
                        seenAsins.add(f.asin);
                        uniqueFindings.push(f);
                    }
                });

                let html = '<div class="result found">';
                html += `<h3>âœ… ${uniqueFindings.length}å€‹ã®ASINãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸï¼</h3>`;

                uniqueFindings.forEach((finding, index) => {
                    html += `
                        <div style="margin: 15px 0; padding: 10px; background: white; border-left: 4px solid #0d6efd;">
                            <strong>ASIN #${index + 1}:</strong> <span class="asin-pattern">${finding.asin}</span><br>
                            <small>æ¤œå‡ºæ–¹æ³•: ${finding.method}</small><br>
                            <small>ã‚½ãƒ¼ã‚¹: <code>${finding.source.substring(0, 100)}${finding.source.length > 100 ? '...' : ''}</code></small>
                        </div>
                    `;
                });

                html += '</div>';

                // çµ±è¨ˆæƒ…å ±
                html += '<div class="result info">';
                html += '<h4>ğŸ“ˆ æ¤œå‡ºçµ±è¨ˆ</h4>';
                html += `<p>æ¤œå‡ºæ–¹æ³•åˆ¥ã®å†…è¨³:</p><ul>`;
                const methodCounts = {};
                uniqueFindings.forEach(f => {
                    methodCounts[f.method] = (methodCounts[f.method] || 0) + 1;
                });
                Object.entries(methodCounts).forEach(([method, count]) => {
                    html += `<li>${method}: ${count}ä»¶</li>`;
                });
                html += '</ul></div>';

                resultsDiv.innerHTML = html;
            }
        }

        function clearInput() {
            document.getElementById('htmlInput').value = '';
            document.getElementById('results').innerHTML = '';
        }
    </script>
</body>

</html>