# UI改善ガイド

## 概要

DD Research WebのUIを大幅に改善し、仕入れに最適な商品を自動サジェストする機能を追加しました。

## 新機能

### 1. 📊 ダッシュボード統計

サイドバー上部に、以下の統計情報をリアルタイム表示：

- **総商品数**: データベース内の全商品数
- **🎯 候補商品**: 自動サジェストされた優良商品数
- **平均粗利率**: 候補商品の平均利益率
- **月間粗利見込み**: 候補商品の月間粗利合計

### 2. 🎯 スマートフィルタ

ワンクリックで最適な商品を絞り込み：

- **💰 高利益商品**: 粗利500円以上
- **📈 高利益率**: 利益率30%以上
- **🔄 高回転**: 月間販売30件以上（候補商品と組み合わせ）
- **⭐ 総合候補**: 全条件を満たす推奨商品
- **🚫 Amazon本体なし**: Amazon本体が出品していない商品
- **🔄 リセット**: 全フィルタをクリア

### 3. 推奨度スコア

各商品に0-100点のスコアを自動計算：

- **70点以上**: 🔥 超優良商品（緑）
- **50-69点**: ⭐ おすすめ商品（青）
- **30-49点**: ✅ 良好な商品（黄）
- **30点未満**: ⚠️ 要検討（グレー）

スコア計算ロジック：
```
推奨度スコア = 粗利貢献度（最大40点） + 粗利率貢献度（最大30点） + 月間販売貢献度（最大30点） - Amazon本体ペナルティ（-20点）
```

### 4. 候補商品の強調表示

推奨商品は行全体が緑色のグラデーションで表示され、一目で判別可能です。

### 5. 仕入れ値の確実な表示

- `dd_cost`カラムがnullの場合、`price_list`から自動取得
- 仕入れ値が太字で強調表示
- データがない場合は「-」を表示

## データベースビューの更新

新機能を利用するには、データベースビューを更新する必要があります。

### Supabase SQL Editorで実行

1. Supabaseダッシュボードにログイン
2. 左メニューから「SQL Editor」を選択
3. 以下のファイルの内容を実行：

```sql
-- database/profit_calculation_view.sql の内容をコピー&ペースト
```

### 主な変更点

- `dd_cost`がnullの場合、`price_list`にフォールバック
- `recommendation_score`カラムを追加（推奨度スコア）
- すべての商品カラムを含めるように拡張
- Keepaデータがない商品も表示（ASIN設定済みの場合）

## 候補商品の判定基準

以下の条件を**すべて満たす**商品が候補として自動サジェストされます：

1. **粗利**: 400円以上
2. **粗利率**: 25%以上
3. **月間販売**: 20件以上
4. **Amazon本体**: なし

これらの基準は、`database/profit_calculation_view.sql`で調整可能です。

## 利益計算ロジック

### 販売価格

```
販売価格 = カート価格（buy_box_price） または 最安値（lowest_new_price）
```

### Amazon入金額

```
Amazon入金額 = 販売価格 × 80%
```

> **注**: 簡易モデルとして手数料20%を想定しています。
> 実際のFBA手数料は商品カテゴリやサイズによって異なります。

### 粗利

```
粗利 = Amazon入金額 - 仕入れ値
```

### 粗利率

```
粗利率 = (粗利 / 仕入れ値) × 100
```

### 月間粗利

```
月間粗利 = 粗利 × 月間販売見込み
```

## 使い方

### 基本的なワークフロー

1. **ダッシュボードで全体像を把握**
   - 候補商品数を確認
   - 平均利益率をチェック

2. **スマートフィルタで絞り込み**
   - 「⭐ 総合候補」をクリック
   - 推奨度スコアでソート（将来実装）

3. **商品を確認**
   - 推奨度スコアが高い商品を優先
   - 緑色の行（候補商品）に注目

4. **詳細リサーチ**
   - Amazonリンクで市場を確認
   - Keepaで価格履歴をチェック
   - Googleで商品情報を検索

5. **仕入れ判断**
   - 粗利、利益率、月間販売を総合的に判断
   - 推奨度スコア50点以上を目安に

### 高度な使い方

#### カスタムフィルタの組み合わせ

```
1. スマートフィルタで絞り込み（例: 高利益商品）
2. さらに手動フィルタを追加（例: ブランド = ミルボン）
3. プリセットとして保存
```

#### プリセットの活用

よく使うフィルタ条件は、プリセットとして保存できます：

1. フィルタ条件を設定
2. プリセット名を入力（例: 「ミルボン 高利益」）
3. 「保存」をクリック
4. 次回からワンクリックで適用可能

## トラブルシューティング

### 仕入れ値が表示されない

**症状**: 仕入れ値カラムが空欄

**原因**:
- `dd_cost`と`price_list`の両方がnull
- データがクローラーで取得できていない

**対処法**:
1. クローラーが正しく動作しているか確認
2. 手動でASINを設定し、Keepaバッチを実行

### ダッシュボード統計が「-」のまま

**症状**: 統計情報が更新されない

**原因**:
- ビューが更新されていない
- Keepaデータがない

**対処法**:
1. `profit_calculation_view.sql`を実行してビューを更新
2. バッチ処理でKeepaデータを取得

### 候補商品が0件

**症状**: 候補商品が1件も表示されない

**原因**:
- 判定基準が厳しすぎる
- Keepaデータが不足

**対処法**:
1. スマートフィルタの各条件を個別に試す
2. ビューの判定基準を調整（`database/profit_calculation_view.sql`）

## 次のステップ

- [ ] ソート機能の強化（推奨度スコアでソート）
- [ ] より詳細な利益計算（カテゴリ別FBA手数料）
- [ ] AIによる自動リサーチレポート
- [ ] 通知機能（優良商品が見つかったらSlack通知）
- [ ] 仕入れリスト管理機能

## フィードバック

改善要望やバグ報告は、GitHubのIssueまたはプルリクエストでお願いします。

